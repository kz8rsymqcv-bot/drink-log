<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é£²æ–™ç´€éŒ„</title>
    
    <!-- iOS App è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è‚¥è±¬å˜‰ç´€éŒ„">
    
    <!-- ğŸ¥¤ ç©ºå¿ƒé£²æ–™æ¯ Icon (Data URI) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%238A9A5B'/%3E%3Cpath d='M35 25 h30 l-6 50 h-18 z' fill='none' stroke='white' stroke-width='4' stroke-linejoin='round'/%3E%3Cpath d='M45 25 v-8 h10 v8' fill='none' stroke='white' stroke-width='4' stroke-linecap='round'/%3E%3Cline x1='30' y1='25' x2='70' y2='25' stroke='white' stroke-width='4' stroke-linecap='round'/%3E%3C/svg%3E">
    <!-- æ¨™æº– Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M35 25 h30 l-6 50 h-18 z' fill='none' stroke='%238A9A5B' stroke-width='4'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide-static/0.321.0/lucide.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        :root {
            --weekend-color: #C08282;
            --main-color: #8A9A5B;
            --bg-color: #F2F4EF;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            background-color: var(--bg-color);
            /* è§£æ±º iOS åº•éƒ¨é»‘é‚Š */
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: env(safe-area-inset-top);
            overscroll-behavior-y: none;
        }

        /* éš±è—æ»¾å‹•æ¢ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* æ•¸å­—éµç›¤å„ªåŒ– */
        input[type="number"]::-webkit-inner-spin-button { display: none; }

        /* é»æ“Šç¸®æ”¾æ•ˆæœ */
        .active-scale:active { transform: scale(0.95); transition: transform 0.1s; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
    </style>
</head>
<body>

    <div id="app" class="max-w-md mx-auto px-4 h-screen flex flex-col overflow-hidden">
        <!-- å…§å®¹å°‡ç”± JavaScript æ¸²æŸ“ -->
    </div>

    <script>
        // --- åˆå§‹åŒ–ç‹€æ…‹ ---
        const today = new Date();
        let state = {
            currentDate: new Date(2026, 0, 1), // é è¨­ 2026 å¹´
            selectedDate: null,
            showModal: false,
            detailView: null,
            // è®€å–æ¨™é¡Œ
            appTitle: localStorage.getItem('fpj_app_title') || "ä¸€éš»è‚¥è±¬å˜‰çš„èª•ç”Ÿ",
            isEditingTitle: false,
            // è®€å–ç´€éŒ„
            records: JSON.parse(localStorage.getItem('fpj_offline_data_v1')) || {}
        };

        const iceOptions = ["æ­£å¸¸", "å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«", "æº«", "ç†±", "å›ºå®š"];
        const sugarOptions = ["å…¨ç³–", "å°‘ç³–", "åŠç³–", "å¾®ç³–", "ä¸€åˆ†", "0.5åˆ†", "ç„¡ç³–", "å›ºå®š"];

        // --- æ ¸å¿ƒåŠŸèƒ½ ---

        function save() {
            localStorage.setItem('fpj_offline_data_v1', JSON.stringify(state.records));
            render();
        }

        function saveTitle(newTitle) {
            state.appTitle = newTitle;
            localStorage.setItem('fpj_app_title', newTitle);
        }

        function formatDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function calculateStats() {
            let mTotal = 0, mCount = 0, yTotal = 0, yCount = 0;
            const comboFreq = {};
            const goodList = [];
            const badList = [];

            Object.keys(state.records).forEach(key => {
                const date = new Date(key);
                const isYear = date.getFullYear() === state.currentDate.getFullYear();
                const isMonth = isYear && date.getMonth() === state.currentDate.getMonth();

                state.records[key].forEach(drink => {
                    const price = Number(drink.price || 0);
                    const name = `${drink.shop}-${drink.item}`;

                    if (isYear) { yTotal += price; yCount++; }
                    if (isMonth) { mTotal += price; mCount++; }

                    if (drink.shop && drink.item) {
                        comboFreq[name] = (comboFreq[name] || 0) + 1;
                    }
                    if (drink.rating === 'good') goodList.push({name, date: key});
                    if (drink.rating === 'bad') badList.push({name, date: key});
                });
            });

            const topCombos = Object.entries(comboFreq)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            return { mTotal, mCount, yTotal, yCount, topCombos, goodList, badList };
        }

        // --- æ¸²æŸ“ UI ---

        function render() {
            const app = document.getElementById('app');
            const stats = calculateStats();
            
            // æ¨™é¡Œç·¨è¼¯å€å¡Š
            let titleHtml = '';
            if (state.isEditingTitle) {
                titleHtml = `<input type="text" id="titleInput" value="${state.appTitle}" class="text-xl font-black text-[#8A9A5B] text-center bg-white rounded-full px-4 py-1 border-2 border-[#8A9A5B] w-full max-w-[260px] outline-none" onblur="finishTitleEdit(this.value)" />`;
            } else {
                titleHtml = `
                    <div onclick="startTitleEdit()" class="flex items-center gap-2 cursor-pointer active:opacity-50">
                        <h1 class="text-xl font-black tracking-widest text-[#8A9A5B]">${state.appTitle}</h1>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#8A9A5B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                    </div>
                `;
            }

            // æ—¥æ›†ç”Ÿæˆ
            const year = state.currentDate.getFullYear();
            const month = state.currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();
            
            let calendarHtml = '';
            // ç©ºç™½æ ¼
            for (let i = 0; i < firstDay; i++) {
                calendarHtml += `<div></div>`;
            }
            // æ—¥æœŸæ ¼
            for (let d = 1; d <= daysInMonth; d++) {
                const dateKey = formatDateKey(new Date(year, month, d));
                const count = (state.records[dateKey] || []).length;
                const isWeekend = (firstDay + d - 1) % 7 === 0 || (firstDay + d - 1) % 7 === 6;
                
                let bgClass = 'bg-white/40';
                if (count === 1) bgClass = 'bg-[#E1EAD1]';
                if (count === 2) bgClass = 'bg-[#FEF5D4]';
                if (count >= 3) bgClass = 'bg-[#FEE2E2]';

                calendarHtml += `
                    <div onclick="openModal(${d})" class="${bgClass} aspect-square flex flex-col items-center justify-center rounded-xl border-[0.5px] border-white/50 active-scale shadow-sm relative">
                        <span class="text-[11px] font-black" style="color: ${isWeekend ? '#C08282' : '#8A9A5B'}">${d}</span>
                        ${count > 0 ? `<span class="text-[7px] font-bold text-slate-400 mt-0.5">$${state.records[dateKey].reduce((s, i) => s + Number(i.price), 0)}</span>` : ''}
                    </div>
                `;
            }

            app.innerHTML = `
                <!-- Header -->
                <div class="flex justify-center items-center py-4 shrink-0">
                    ${titleHtml}
                </div>

                <!-- Stats Cards (å¹´åº¦/æœ¬æœˆ ä¸¦æ’) -->
                <div class="grid grid-cols-2 gap-3 mb-3 shrink-0">
                    <div class="bg-white/80 p-3 rounded-[1.5rem] shadow-sm border border-white text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-[#CD5C5C]/20"></div>
                        <p class="text-[10px] font-black text-[#CD5C5C] mb-1 tracking-widest">å¹´åº¦ç´¯è¨ˆ</p>
                        <p class="text-sm font-black text-slate-700">${stats.yCount} <span class="text-[10px] text-slate-400">æ¯</span> <span class="text-[#CD5C5C] ml-1">$${stats.yTotal.toLocaleString()}</span></p>
                    </div>
                    <div class="bg-white/80 p-3 rounded-[1.5rem] shadow-sm border border-white text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-[#8A9A5B]/20"></div>
                        <p class="text-[10px] font-black text-[#8A9A5B] mb-1 tracking-widest">æœ¬æœˆçµ±è¨ˆ</p>
                        <p class="text-sm font-black text-slate-700">${stats.mCount} <span class="text-[10px] text-slate-400">æ¯</span> <span class="text-[#556B2F] ml-1">$${stats.mTotal.toLocaleString()}</span></p>
                    </div>
                </div>

                <!-- Month Selector -->
                <div class="flex justify-center mb-3 shrink-0">
                    <div class="flex items-center gap-6 bg-white/60 px-6 py-1.5 rounded-full border border-white/40 shadow-sm">
                        <button onclick="changeMonth(-1)" class="text-[#8A9A5B] font-bold text-lg active:scale-75 transition-transform">ã€ˆ</button>
                        <p class="font-black text-base tracking-tighter text-[#556B2F] min-w-[80px] text-center">
                            ${year}.${String(month + 1).padStart(2, '0')}
                        </p>
                        <button onclick="changeMonth(1)" class="text-[#8A9A5B] font-bold text-lg active:scale-75 transition-transform">ã€‰</button>
                    </div>
                </div>

                <!-- Calendar (Scrollable if needed, but fits one screen) -->
                <div class="bg-white/95 rounded-[2rem] p-4 shadow-sm border border-white mb-3 flex-1 flex flex-col relative overflow-hidden">
                    <div class="grid grid-cols-7 mb-2 text-center">
                        ${['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map((d, i) => 
                            `<div class="text-[10px] font-black" style="color: ${i===0||i===6 ? '#C08282' : '#A5B997'}">${d}</div>`
                        ).join('')}
                    </div>
                    <div class="calendar-grid h-full content-start overflow-y-auto no-scrollbar pb-2">
                        ${calendarHtml}
                    </div>
                </div>

                <!-- Bottom Area -->
                <div class="shrink-0 space-y-3 pb-2">
                    <!-- Top Combos -->
                    <div class="bg-white/70 px-4 py-3 rounded-[1.5rem] border border-white relative shadow-sm flex items-center gap-3">
                        <div class="bg-[#8A9A5B] text-white w-8 h-8 rounded-full flex flex-col items-center justify-center shadow-sm shrink-0">
                             <span class="text-[8px] font-black">TOP</span>
                        </div>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1 items-center">
                            ${stats.topCombos.length > 0 ? stats.topCombos.map(([combo, count]) => `
                                <div class="flex-shrink-0 bg-white px-3 py-1.5 rounded-xl border border-[#E1EAD1] text-center min-w-[80px]">
                                    <div class="text-[10px] font-black text-[#556B2F] truncate max-w-[80px]">${combo}</div>
                                    <div class="text-[8px] font-bold text-slate-300">${count} æ¬¡</div>
                                </div>
                            `).join('') : '<span class="text-[10px] text-slate-400 italic pl-2">å°šç„¡æ’å...</span>'}
                        </div>
                    </div>

                    <!-- Good/Bad Buttons -->
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="openDetail('good')" class="bg-white/70 py-3 rounded-[1.2rem] border border-white flex items-center justify-center gap-2 text-[11px] font-black shadow-sm active-scale">
                             ğŸ‘ è®šè®š (${stats.goodList.length})
                        </button>
                        <button onclick="openDetail('bad')" class="bg-white/70 py-3 rounded-[1.2rem] border border-white flex items-center justify-center gap-2 text-[11px] font-black shadow-sm active-scale">
                             ğŸ‘ è¸©é›· (${stats.badList.length})
                        </button>
                    </div>
                </div>
            `;
        }

        // --- äº’å‹•é‚è¼¯ ---

        function startTitleEdit() {
            state.isEditingTitle = true;
            render();
            setTimeout(() => document.getElementById('titleInput').focus(), 50);
        }

        function finishTitleEdit(val) {
            if(val.trim()) saveTitle(val.trim());
            state.isEditingTitle = false;
            render();
        }

        function changeMonth(step) {
            state.currentDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth() + step, 1);
            render();
        }

        function openModal(day) {
            state.selectedDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth(), day);
            
            const dateKey = formatDateKey(state.selectedDate);
            // è‡ªå‹•è£œé½Šç©ºè³‡æ–™
            if (!state.records[dateKey]) state.records[dateKey] = [];
            
            showEditModal();
        }

        function updateDrink(idx, field, val) {
            const dateKey = formatDateKey(state.selectedDate);
            // ç¢ºä¿è©²ç´¢å¼•å­˜åœ¨
            while (state.records[dateKey].length <= idx) {
                state.records[dateKey].push({ shop: '', item: '', ice: 'å»å†°', sugar: 'ç„¡ç³–', price: 0, rating: null });
            }
            
            state.records[dateKey][idx][field] = val;
            save();
            showEditModal(); // é‡æ–°æ¸²æŸ“ Modal æ›´æ–° UI
        }

        function removeDrink(idx) {
            const dateKey = formatDateKey(state.selectedDate);
            state.records[dateKey].splice(idx, 1);
            if (state.records[dateKey].length === 0) delete state.records[dateKey];
            save();
            showEditModal();
        }

        function showEditModal() {
            const dateKey = formatDateKey(state.selectedDate);
            const list = state.records[dateKey] || [];
            
            // ç¸½æ˜¯é ç•™ä¸€å€‹æ–°å¢æŒ‰éˆ•çš„ä½ç½®ï¼Œé™¤éå·²ç¶“3æ¯
            const displayCount = Math.min(list.length + 1, 3);
            
            let contentHtml = '';
            
            for(let i=0; i<3; i++) {
                const drink = list[i];
                const exists = !!drink;
                
                // é¡¯ç¤ºæ¢ä»¶ï¼š
                // 1. è©²æ¯å·²å­˜åœ¨
                // 2. æˆ–æ˜¯ä¸Šä¸€æ¯å·²å­˜åœ¨ (å¯æ–°å¢ä¸‹ä¸€æ¯)
                // 3. ç¬¬ä¸€æ¯æ°¸é é¡¯ç¤º (å¦‚æœå®Œå…¨æ²’è³‡æ–™)
                const canShow = i === 0 || (list[i-1] && list[i-1].item);
                
                if (!canShow) continue;

                if (!exists) {
                    contentHtml += `
                        <div class="p-5 rounded-[2rem] bg-[#F2F4EF] border-2 border-dashed border-[#DDE4D1]">
                            <button onclick="updateDrink(${i}, 'item', '')" class="w-full py-4 text-[#A5B997] font-black text-xs flex flex-col items-center gap-1 active:opacity-60">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 5v14M5 12h14"/></svg>
                                æ–°å¢ç¬¬ ${i+1} æ¯
                            </button>
                        </div>
                    `;
                } else {
                    contentHtml += `
                        <div class="p-5 rounded-[2rem] bg-white shadow-sm border border-white space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="bg-[#8A9A5B] text-white px-3 py-1 rounded-full text-[10px] font-black tracking-widest">NO.${i+1}</span>
                                <div class="flex gap-2">
                                    <button onclick="updateDrink(${i}, 'rating', '${drink.rating==='good'?'null':'good'}')" class="p-1.5 rounded-lg ${drink.rating==='good'?'bg-[#E1EAD1] text-[#8A9A5B]':'text-slate-300'}"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg></button>
                                    <button onclick="updateDrink(${i}, 'rating', '${drink.rating==='bad'?'null':'bad'}')" class="p-1.5 rounded-lg ${drink.rating==='bad'?'bg-[#FEE2E2] text-[#CD5C5C]':'text-slate-300'}"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zM17 2h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"/></svg></button>
                                    <button onclick="removeDrink(${i})" class="text-slate-200 ml-2"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" placeholder="åº—å®¶" value="${drink.shop}" onchange="updateDrink(${i}, 'shop', this.value)" class="bg-[#F2F4EF] p-3 rounded-xl text-xs font-bold w-full border-none outline-none focus:ring-1 focus:ring-[#8A9A5B]">
                                <input type="text" placeholder="å“é …" value="${drink.item}" onchange="updateDrink(${i}, 'item', this.value)" class="bg-[#F2F4EF] p-3 rounded-xl text-xs font-bold w-full border-none outline-none focus:ring-1 focus:ring-[#8A9A5B]">
                            </div>

                            <div class="space-y-1">
                                <p class="text-[10px] font-black text-[#A5B997] ml-1">ç”œåº¦</p>
                                <div class="flex flex-wrap gap-1.5">
                                    ${sugarOptions.map(opt => `<button onclick="updateDrink(${i}, 'sugar', '${opt}')" class="px-2.5 py-1.5 rounded-lg text-[10px] font-black transition-colors ${drink.sugar===opt ? 'bg-[#8A9A5B] text-white shadow-sm' : 'bg-[#F2F4EF] text-[#A5B997]'}">${opt}</button>`).join('')}
                                </div>
                            </div>
                            
                            <div class="space-y-1">
                                <p class="text-[10px] font-black text-[#A5B997] ml-1">å†°é‡</p>
                                <div class="flex flex-wrap gap-1.5">
                                    ${iceOptions.map(opt => `<button onclick="updateDrink(${i}, 'ice', '${opt}')" class="px-2.5 py-1.5 rounded-lg text-[10px] font-black transition-colors ${drink.ice===opt ? 'bg-[#8A9A5B] text-white shadow-sm' : 'bg-[#F2F4EF] text-[#A5B997]'}">${opt}</button>`).join('')}
                                </div>
                            </div>

                            <div class="relative pt-2">
                                <span class="absolute left-3 top-5 text-[#8A9A5B] font-black text-xs">$</span>
                                <input type="number" inputMode="decimal" placeholder="é‡‘é¡" value="${drink.price||''}" onchange="updateDrink(${i}, 'price', this.value)" class="w-full bg-[#F2F4EF] pl-8 p-3 rounded-xl text-sm font-black border-none outline-none focus:ring-1 focus:ring-[#8A9A5B]">
                            </div>
                        </div>
                    `;
                }
            }

            const modal = document.createElement('div');
            modal.id = 'editModal';
            modal.className = 'fixed inset-0 bg-[#556B2F]/40 backdrop-blur-md z-[100] flex items-end animate-fade-in';
            modal.innerHTML = `
                <div class="bg-[#FAFBF9] w-full rounded-t-[2.5rem] max-h-[85vh] overflow-y-auto p-6 pb-12 no-scrollbar shadow-2xl animate-slide-up">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-black text-[#556B2F]">${state.selectedDate.getMonth()+1}æœˆ${state.selectedDate.getDate()}æ—¥</h3>
                        <button onclick="closeEditModal()" class="w-8 h-8 bg-white rounded-full flex items-center justify-center shadow-sm text-slate-300">âœ•</button>
                    </div>
                    <div class="space-y-4">
                        ${contentHtml}
                    </div>
                    <button onclick="closeEditModal()" class="w-full mt-8 py-4 bg-[#556B2F] text-white rounded-[1.5rem] font-black text-base shadow-xl active-scale">å„²å­˜ç´€éŒ„</button>
                </div>
            `;
            
            // ç§»é™¤èˆŠçš„ (å¦‚æœæœ‰)
            const old = document.getElementById('editModal');
            if(old) old.remove();
            
            document.body.appendChild(modal);
        }

        function closeEditModal() {
            const m = document.getElementById('editModal');
            if(m) m.remove();
            render(); // æ›´æ–°ä¸»ç•«é¢
        }

        function openDetail(type) {
            const stats = calculateStats();
            const list = type === 'good' ? stats.goodList : stats.badList;
            const title = type === 'good' ? 'ğŸ‘ è®šè®šæ¸…å–®' : 'ğŸ‘ è¸©é›·ç´€éŒ„';
            const color = type === 'good' ? '#A5B997' : '#E2A7A7';
            
            const listHtml = list.length > 0 ? list.map(d => `
                <div class="flex justify-between p-3 bg-[#F2F4EF] rounded-xl text-xs font-black">
                    <span>${d.name}</span>
                    <span class="opacity-40">${d.date.slice(5)}</span>
                </div>
            `).join('') : `<p class="text-center text-xs text-slate-300 py-6">å°šç„¡è³‡æ–™</p>`;

            const modal = document.createElement('div');
            modal.id = 'detailModal';
            modal.className = 'fixed inset-0 bg-black/60 backdrop-blur-md z-[110] flex items-center justify-center p-8';
            modal.onclick = closeDetailModal;
            modal.innerHTML = `
                <div class="bg-white w-full rounded-[2.5rem] p-6 shadow-2xl" onclick="event.stopPropagation()">
                    <h3 class="text-center font-black mb-4 flex items-center justify-center gap-2" style="color:${color}">${title}</h3>
                    <div class="max-h-60 overflow-y-auto space-y-2 no-scrollbar">
                        ${listHtml}
                    </div>
                    <button onclick="closeDetailModal()" class="w-full mt-4 py-3 bg-[#556B2F] text-white rounded-xl font-black">é—œé–‰</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeDetailModal() {
            const m = document.getElementById('detailModal');
            if(m) m.remove();
        }

        // --- å•Ÿå‹• ---
        render();

        // é˜²æ­¢æ©¡çš®ç­‹æ•ˆæœ
        document.body.addEventListener('touchmove', function(e) {
            if(e.target.closest('.no-scrollbar')) return; // å…è¨±å…§éƒ¨æ»¾å‹•
            // e.preventDefault(); // è¦–æƒ…æ³é–‹å•Ÿï¼Œå¯èƒ½æœƒé–æ­»é é¢
        }, { passive: false });

    </script>
</body>
</html>
